
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>google.cloud.storage.bucket &#8212; google-cloud dda5f1f documentation</title>
    <link rel="stylesheet" href="../../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for google.cloud.storage.bucket</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2014 Google LLC</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="sd">&quot;&quot;&quot;Create / interact with Google Cloud Storage buckets.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">six</span>

<span class="kn">from</span> <span class="nn">google.api_core</span> <span class="k">import</span> <span class="n">page_iterator</span>
<span class="kn">from</span> <span class="nn">google.api_core</span> <span class="k">import</span> <span class="n">datetime_helpers</span>
<span class="kn">from</span> <span class="nn">google.cloud._helpers</span> <span class="k">import</span> <span class="n">_datetime_to_rfc3339</span>
<span class="kn">from</span> <span class="nn">google.cloud._helpers</span> <span class="k">import</span> <span class="n">_NOW</span>
<span class="kn">from</span> <span class="nn">google.cloud._helpers</span> <span class="k">import</span> <span class="n">_rfc3339_to_datetime</span>
<span class="kn">from</span> <span class="nn">google.cloud.exceptions</span> <span class="k">import</span> <span class="n">NotFound</span>
<span class="kn">from</span> <span class="nn">google.api_core.iam</span> <span class="k">import</span> <span class="n">Policy</span>
<span class="kn">from</span> <span class="nn">google.cloud.storage</span> <span class="k">import</span> <span class="n">_signing</span>
<span class="kn">from</span> <span class="nn">google.cloud.storage._helpers</span> <span class="k">import</span> <span class="n">_PropertyMixin</span>
<span class="kn">from</span> <span class="nn">google.cloud.storage._helpers</span> <span class="k">import</span> <span class="n">_scalar_property</span>
<span class="kn">from</span> <span class="nn">google.cloud.storage._helpers</span> <span class="k">import</span> <span class="n">_validate_name</span>
<span class="kn">from</span> <span class="nn">google.cloud.storage._signing</span> <span class="k">import</span> <span class="n">generate_signed_url_v2</span>
<span class="kn">from</span> <span class="nn">google.cloud.storage._signing</span> <span class="k">import</span> <span class="n">generate_signed_url_v4</span>
<span class="kn">from</span> <span class="nn">google.cloud.storage.acl</span> <span class="k">import</span> <span class="n">BucketACL</span>
<span class="kn">from</span> <span class="nn">google.cloud.storage.acl</span> <span class="k">import</span> <span class="n">DefaultObjectACL</span>
<span class="kn">from</span> <span class="nn">google.cloud.storage.blob</span> <span class="k">import</span> <span class="n">Blob</span>
<span class="kn">from</span> <span class="nn">google.cloud.storage.notification</span> <span class="k">import</span> <span class="n">BucketNotification</span>
<span class="kn">from</span> <span class="nn">google.cloud.storage.notification</span> <span class="k">import</span> <span class="n">NONE_PAYLOAD_FORMAT</span>


<span class="n">_LOCATION_SETTER_MESSAGE</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;Assignment to &#39;Bucket.location&#39; is deprecated, as it is only &quot;</span>
    <span class="s2">&quot;valid before the bucket is created. Instead, pass the location &quot;</span>
    <span class="s2">&quot;to `Bucket.create`.&quot;</span>
<span class="p">)</span>
<span class="n">_API_ACCESS_ENDPOINT</span> <span class="o">=</span> <span class="s2">&quot;https://storage.googleapis.com&quot;</span>


<span class="k">def</span> <span class="nf">_blobs_page_start</span><span class="p">(</span><span class="n">iterator</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Grab prefixes after a :class:`~google.cloud.iterator.Page` started.</span>

<span class="sd">    :type iterator: :class:`~google.api_core.page_iterator.Iterator`</span>
<span class="sd">    :param iterator: The iterator that is currently in use.</span>

<span class="sd">    :type page: :class:`~google.cloud.api.core.page_iterator.Page`</span>
<span class="sd">    :param page: The page that was just created.</span>

<span class="sd">    :type response: dict</span>
<span class="sd">    :param response: The JSON API response for a page of blobs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">page</span><span class="o">.</span><span class="n">prefixes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;prefixes&quot;</span><span class="p">,</span> <span class="p">()))</span>
    <span class="n">iterator</span><span class="o">.</span><span class="n">prefixes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">prefixes</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_item_to_blob</span><span class="p">(</span><span class="n">iterator</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a JSON blob to the native object.</span>

<span class="sd">    .. note::</span>

<span class="sd">        This assumes that the ``bucket`` attribute has been</span>
<span class="sd">        added to the iterator after being created.</span>

<span class="sd">    :type iterator: :class:`~google.api_core.page_iterator.Iterator`</span>
<span class="sd">    :param iterator: The iterator that has retrieved the item.</span>

<span class="sd">    :type item: dict</span>
<span class="sd">    :param item: An item to be converted to a blob.</span>

<span class="sd">    :rtype: :class:`.Blob`</span>
<span class="sd">    :returns: The next blob in the page.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
    <span class="n">blob</span> <span class="o">=</span> <span class="n">Blob</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">bucket</span><span class="o">=</span><span class="n">iterator</span><span class="o">.</span><span class="n">bucket</span><span class="p">)</span>
    <span class="n">blob</span><span class="o">.</span><span class="n">_set_properties</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">blob</span>


<span class="k">def</span> <span class="nf">_item_to_notification</span><span class="p">(</span><span class="n">iterator</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a JSON blob to the native object.</span>

<span class="sd">    .. note::</span>

<span class="sd">        This assumes that the ``bucket`` attribute has been</span>
<span class="sd">        added to the iterator after being created.</span>

<span class="sd">    :type iterator: :class:`~google.api_core.page_iterator.Iterator`</span>
<span class="sd">    :param iterator: The iterator that has retrieved the item.</span>

<span class="sd">    :type item: dict</span>
<span class="sd">    :param item: An item to be converted to a blob.</span>

<span class="sd">    :rtype: :class:`.BucketNotification`</span>
<span class="sd">    :returns: The next notification being iterated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">BucketNotification</span><span class="o">.</span><span class="n">from_api_repr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">bucket</span><span class="o">=</span><span class="n">iterator</span><span class="o">.</span><span class="n">bucket</span><span class="p">)</span>


<div class="viewcode-block" id="LifecycleRuleConditions"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.LifecycleRuleConditions">[docs]</a><span class="k">class</span> <span class="nc">LifecycleRuleConditions</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Map a single lifecycle rule for a bucket.</span>

<span class="sd">    See: https://cloud.google.com/storage/docs/lifecycle</span>

<span class="sd">    :type age: int</span>
<span class="sd">    :param age: (optional) apply rule action to items whos age, in days,</span>
<span class="sd">                exceeds this value.</span>

<span class="sd">    :type created_before: datetime.date</span>
<span class="sd">    :param created_before: (optional) apply rule action to items created</span>
<span class="sd">                           before this date.</span>

<span class="sd">    :type is_live: bool</span>
<span class="sd">    :param is_live: (optional) if true, apply rule action to non-versioned</span>
<span class="sd">                    items, or to items with no newer versions. If false, apply</span>
<span class="sd">                    rule action to versioned items with at least one newer</span>
<span class="sd">                    version.</span>

<span class="sd">    :type matches_storage_class: list(str), one or more of</span>
<span class="sd">                                 :attr:`Bucket._STORAGE_CLASSES`.</span>
<span class="sd">    :param matches_storage_class: (optional) apply rule action to items which</span>
<span class="sd">                                  whose storage class matches this value.</span>

<span class="sd">    :type number_of_newer_versions: int</span>
<span class="sd">    :param number_of_newer_versions: (optional) apply rule action to versioned</span>
<span class="sd">                                     items having N newer versions.</span>

<span class="sd">    :raises ValueError: if no arguments are passed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">age</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">created_before</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">is_live</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">matches_storage_class</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">number_of_newer_versions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">_factory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">conditions</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">age</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">conditions</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">age</span>

        <span class="k">if</span> <span class="n">created_before</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">conditions</span><span class="p">[</span><span class="s2">&quot;createdBefore&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">created_before</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">is_live</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">conditions</span><span class="p">[</span><span class="s2">&quot;isLive&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_live</span>

        <span class="k">if</span> <span class="n">matches_storage_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">conditions</span><span class="p">[</span><span class="s2">&quot;matchesStorageClass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">matches_storage_class</span>

        <span class="k">if</span> <span class="n">number_of_newer_versions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">conditions</span><span class="p">[</span><span class="s2">&quot;numNewerVersions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">number_of_newer_versions</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">_factory</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">conditions</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Supply at least one condition&quot;</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">LifecycleRuleConditions</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span>

<div class="viewcode-block" id="LifecycleRuleConditions.from_api_repr"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.LifecycleRuleConditions.from_api_repr">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_api_repr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resource</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Factory:  construct instance from resource.</span>

<span class="sd">        :type resource: dict</span>
<span class="sd">        :param resource: mapping as returned from API call.</span>

<span class="sd">        :rtype: :class:`LifecycleRuleConditions`</span>
<span class="sd">        :returns: Instance created from resource.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">_factory</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">instance</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">age</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Conditon&#39;s age value.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;age&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">created_before</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Conditon&#39;s created_before value.&quot;&quot;&quot;</span>
        <span class="n">before</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;createdBefore&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">before</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">datetime_helpers</span><span class="o">.</span><span class="n">from_iso8601_date</span><span class="p">(</span><span class="n">before</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_live</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Conditon&#39;s &#39;is_live&#39; value.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;isLive&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">matches_storage_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Conditon&#39;s &#39;matches_storage_class&#39; value.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;matchesStorageClass&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">number_of_newer_versions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Conditon&#39;s &#39;number_of_newer_versions&#39; value.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;numNewerVersions&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="LifecycleRuleDelete"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.LifecycleRuleDelete">[docs]</a><span class="k">class</span> <span class="nc">LifecycleRuleDelete</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Map a lifecycle rule deleting matching items.</span>

<span class="sd">    :type kw: dict</span>
<span class="sd">    :params kw: arguments passed to :class:`LifecycleRuleConditions`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">conditions</span> <span class="o">=</span> <span class="n">LifecycleRuleConditions</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Delete&quot;</span><span class="p">},</span> <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">conditions</span><span class="p">)}</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LifecycleRuleDelete</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>

<div class="viewcode-block" id="LifecycleRuleDelete.from_api_repr"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.LifecycleRuleDelete.from_api_repr">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_api_repr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resource</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Factory:  construct instance from resource.</span>

<span class="sd">        :type resource: dict</span>
<span class="sd">        :param resource: mapping as returned from API call.</span>

<span class="sd">        :rtype: :class:`LifecycleRuleDelete`</span>
<span class="sd">        :returns: Instance created from resource.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">_factory</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">instance</span></div></div>


<div class="viewcode-block" id="LifecycleRuleSetStorageClass"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.LifecycleRuleSetStorageClass">[docs]</a><span class="k">class</span> <span class="nc">LifecycleRuleSetStorageClass</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Map a lifecycle rule upating storage class of matching items.</span>

<span class="sd">    :type storage_class: str, one of :attr:`Bucket._STORAGE_CLASSES`.</span>
<span class="sd">    :param storage_class: new storage class to assign to matching items.</span>

<span class="sd">    :type kw: dict</span>
<span class="sd">    :params kw: arguments passed to :class:`LifecycleRuleConditions`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_class</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">conditions</span> <span class="o">=</span> <span class="n">LifecycleRuleConditions</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;SetStorageClass&quot;</span><span class="p">,</span> <span class="s2">&quot;storageClass&quot;</span><span class="p">:</span> <span class="n">storage_class</span><span class="p">},</span>
            <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">conditions</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LifecycleRuleSetStorageClass</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>

<div class="viewcode-block" id="LifecycleRuleSetStorageClass.from_api_repr"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.LifecycleRuleSetStorageClass.from_api_repr">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_api_repr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resource</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Factory:  construct instance from resource.</span>

<span class="sd">        :type resource: dict</span>
<span class="sd">        :param resource: mapping as returned from API call.</span>

<span class="sd">        :rtype: :class:`LifecycleRuleDelete`</span>
<span class="sd">        :returns: Instance created from resource.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">resource</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">action</span><span class="p">[</span><span class="s2">&quot;storageClass&quot;</span><span class="p">],</span> <span class="n">_factory</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">instance</span></div></div>


<div class="viewcode-block" id="IAMConfiguration"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.IAMConfiguration">[docs]</a><span class="k">class</span> <span class="nc">IAMConfiguration</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Map a bucket&#39;s IAM configuration.</span>

<span class="sd">    :type bucket: :class:`Bucket`</span>
<span class="sd">    :params bucket: Bucket for which this instance is the policy.</span>

<span class="sd">    :type bucket_policy_only_enabled: bool</span>
<span class="sd">    :params bucket_policy_only_enabled: (optional) whether the IAM-only policy is enabled for the bucket.</span>

<span class="sd">    :type bucket_policy_only_locked_time: :class:`datetime.datetime`</span>
<span class="sd">    :params bucket_policy_only_locked_time: (optional) When the bucket&#39;s IAM-only policy was ehabled.  This value should normally only be set by the back-end API.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bucket</span><span class="p">,</span>
        <span class="n">bucket_policy_only_enabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">bucket_policy_only_locked_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;bucketPolicyOnly&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="n">bucket_policy_only_enabled</span><span class="p">}}</span>
        <span class="k">if</span> <span class="n">bucket_policy_only_locked_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;bucketPolicyOnly&quot;</span><span class="p">][</span><span class="s2">&quot;lockedTime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_datetime_to_rfc3339</span><span class="p">(</span>
                <span class="n">bucket_policy_only_locked_time</span>
            <span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">IAMConfiguration</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bucket</span> <span class="o">=</span> <span class="n">bucket</span>

<div class="viewcode-block" id="IAMConfiguration.from_api_repr"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.IAMConfiguration.from_api_repr">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_api_repr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">bucket</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Factory:  construct instance from resource.</span>

<span class="sd">        :type bucket: :class:`Bucket`</span>
<span class="sd">        :params bucket: Bucket for which this instance is the policy.</span>

<span class="sd">        :type resource: dict</span>
<span class="sd">        :param resource: mapping as returned from API call.</span>

<span class="sd">        :rtype: :class:`IAMConfiguration`</span>
<span class="sd">        :returns: Instance created from resource.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">instance</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bucket</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Bucket for which this instance is the policy.</span>

<span class="sd">        :rtype: :class:`Bucket`</span>
<span class="sd">        :returns: the instance&#39;s bucket.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bucket</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bucket_policy_only_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;If set, access checks only use bucket-level IAM policies or above.</span>

<span class="sd">        :rtype: bool</span>
<span class="sd">        :returns: whether the bucket is configured to allow only IAM.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bpo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bucketPolicyOnly&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">return</span> <span class="n">bpo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enabled&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="nd">@bucket_policy_only_enabled</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">bucket_policy_only_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">bpo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;bucketPolicyOnly&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">bpo</span><span class="p">[</span><span class="s2">&quot;enabled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="o">.</span><span class="n">_patch_property</span><span class="p">(</span><span class="s2">&quot;iamConfiguration&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bucket_policy_only_locked_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deadline for changing :attr:`bucket_policy_only_enabled` from true to false.</span>

<span class="sd">        If the bucket&#39;s :attr:`bucket_policy_only_enabled` is true, this property</span>
<span class="sd">        is time time after which that setting becomes immutable.</span>

<span class="sd">        If the bucket&#39;s :attr:`bucket_policy_only_enabled` is false, this property</span>
<span class="sd">        is ``None``.</span>

<span class="sd">        :rtype: Union[:class:`datetime.datetime`, None]</span>
<span class="sd">        :returns:  (readonly) Time after which :attr:`bucket_policy_only_enabled` will</span>
<span class="sd">                   be frozen as true.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bpo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bucketPolicyOnly&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">stamp</span> <span class="o">=</span> <span class="n">bpo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lockedTime&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">stamp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stamp</span> <span class="o">=</span> <span class="n">_rfc3339_to_datetime</span><span class="p">(</span><span class="n">stamp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stamp</span></div>


<div class="viewcode-block" id="Bucket"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket">[docs]</a><span class="k">class</span> <span class="nc">Bucket</span><span class="p">(</span><span class="n">_PropertyMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A class representing a Bucket on Cloud Storage.</span>

<span class="sd">    :type client: :class:`google.cloud.storage.client.Client`</span>
<span class="sd">    :param client: A client which holds credentials and project configuration</span>
<span class="sd">                   for the bucket (which requires a project).</span>

<span class="sd">    :type name: str</span>
<span class="sd">    :param name: The name of the bucket. Bucket names must start and end with a</span>
<span class="sd">                 number or letter.</span>

<span class="sd">    :type user_project: str</span>
<span class="sd">    :param user_project: (Optional) the project ID to be billed for API</span>
<span class="sd">                         requests made via this instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_MAX_OBJECTS_FOR_ITERATION</span> <span class="o">=</span> <span class="mi">256</span>
    <span class="sd">&quot;&quot;&quot;Maximum number of existing objects allowed in iteration.</span>

<span class="sd">    This is used in Bucket.delete() and Bucket.make_public().</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_STORAGE_CLASSES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;MULTI_REGIONAL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;REGIONAL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NEARLINE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;COLDLINE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;STANDARD&quot;</span><span class="p">,</span>  <span class="c1"># alias for MULTI_REGIONAL/REGIONAL, based on location</span>
        <span class="s2">&quot;DURABLE_REDUCED_AVAILABILITY&quot;</span><span class="p">,</span>  <span class="c1"># deprecated</span>
    <span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;Allowed values for :attr:`storage_class`.</span>

<span class="sd">    See</span>
<span class="sd">    https://cloud.google.com/storage/docs/json_api/v1/buckets#storageClass</span>
<span class="sd">    https://cloud.google.com/storage/docs/storage-classes</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user_project</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">_validate_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Bucket</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_client</span> <span class="o">=</span> <span class="n">client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_acl</span> <span class="o">=</span> <span class="n">BucketACL</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_object_acl</span> <span class="o">=</span> <span class="n">DefaultObjectACL</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_label_removals</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user_project</span> <span class="o">=</span> <span class="n">user_project</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;Bucket: </span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The client bound to this bucket.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span>

    <span class="k">def</span> <span class="nf">_set_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the properties for the current object.</span>

<span class="sd">        :type value: dict or :class:`google.cloud.storage.batch._FutureDict`</span>
<span class="sd">        :param value: The properties to be set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_label_removals</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Bucket</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_set_properties</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">user_project</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Project ID to be billed for API requests made via this bucket.</span>

<span class="sd">        If unset, API requests are billed to the bucket owner.</span>

<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_project</span>

<div class="viewcode-block" id="Bucket.blob"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.blob">[docs]</a>    <span class="k">def</span> <span class="nf">blob</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">blob_name</span><span class="p">,</span>
        <span class="n">chunk_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">encryption_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">kms_key_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">generation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Factory constructor for blob object.</span>

<span class="sd">        .. note::</span>
<span class="sd">          This will not make an HTTP request; it simply instantiates</span>
<span class="sd">          a blob object owned by this bucket.</span>

<span class="sd">        :type blob_name: str</span>
<span class="sd">        :param blob_name: The name of the blob to be instantiated.</span>

<span class="sd">        :type chunk_size: int</span>
<span class="sd">        :param chunk_size: The size of a chunk of data whenever iterating</span>
<span class="sd">                           (in bytes). This must be a multiple of 256 KB per</span>
<span class="sd">                           the API specification.</span>

<span class="sd">        :type encryption_key: bytes</span>
<span class="sd">        :param encryption_key:</span>
<span class="sd">            Optional 32 byte encryption key for customer-supplied encryption.</span>

<span class="sd">        :type kms_key_name: str</span>
<span class="sd">        :param kms_key_name:</span>
<span class="sd">            Optional resource name of KMS key used to encrypt blob&#39;s content.</span>

<span class="sd">        :type generation: long</span>
<span class="sd">        :param generation: Optional. If present, selects a specific revision of</span>
<span class="sd">                           this object.</span>

<span class="sd">        :rtype: :class:`google.cloud.storage.blob.Blob`</span>
<span class="sd">        :returns: The blob object created.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Blob</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">blob_name</span><span class="p">,</span>
            <span class="n">bucket</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">,</span>
            <span class="n">encryption_key</span><span class="o">=</span><span class="n">encryption_key</span><span class="p">,</span>
            <span class="n">kms_key_name</span><span class="o">=</span><span class="n">kms_key_name</span><span class="p">,</span>
            <span class="n">generation</span><span class="o">=</span><span class="n">generation</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Bucket.notification"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.notification">[docs]</a>    <span class="k">def</span> <span class="nf">notification</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">topic_name</span><span class="p">,</span>
        <span class="n">topic_project</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">custom_attributes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">event_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">blob_name_prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">payload_format</span><span class="o">=</span><span class="n">NONE_PAYLOAD_FORMAT</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Factory:  create a notification resource for the bucket.</span>

<span class="sd">        See: :class:`.BucketNotification` for parameters.</span>

<span class="sd">        :rtype: :class:`.BucketNotification`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">BucketNotification</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">topic_name</span><span class="p">,</span>
            <span class="n">topic_project</span><span class="o">=</span><span class="n">topic_project</span><span class="p">,</span>
            <span class="n">custom_attributes</span><span class="o">=</span><span class="n">custom_attributes</span><span class="p">,</span>
            <span class="n">event_types</span><span class="o">=</span><span class="n">event_types</span><span class="p">,</span>
            <span class="n">blob_name_prefix</span><span class="o">=</span><span class="n">blob_name_prefix</span><span class="p">,</span>
            <span class="n">payload_format</span><span class="o">=</span><span class="n">payload_format</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Bucket.exists"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.exists">[docs]</a>    <span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determines whether or not this bucket exists.</span>

<span class="sd">        If :attr:`user_project` is set, bills the API request to that project.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: Optional. The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the current bucket.</span>

<span class="sd">        :rtype: bool</span>
<span class="sd">        :returns: True if the bucket exists in Cloud Storage.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_require_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
        <span class="c1"># We only need the status code (200 or not) so we seek to</span>
        <span class="c1"># minimize the returned payload.</span>
        <span class="n">query_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="s2">&quot;name&quot;</span><span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_params</span><span class="p">[</span><span class="s2">&quot;userProject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># We intentionally pass `_target_object=None` since fields=name</span>
            <span class="c1"># would limit the local properties.</span>
            <span class="n">client</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">api_request</span><span class="p">(</span>
                <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
                <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
                <span class="n">query_params</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span>
                <span class="n">_target_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># NOTE: This will not fail immediately in a batch. However, when</span>
            <span class="c1">#       Batch.finish() is called, the resulting `NotFound` will be</span>
            <span class="c1">#       raised.</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="n">NotFound</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Bucket.create"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.create">[docs]</a>    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates current bucket.</span>

<span class="sd">        If the bucket already exists, will raise</span>
<span class="sd">        :class:`google.cloud.exceptions.Conflict`.</span>

<span class="sd">        This implements &quot;storage.buckets.insert&quot;.</span>

<span class="sd">        If :attr:`user_project` is set, bills the API request to that project.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: Optional. The client to use. If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the current bucket.</span>

<span class="sd">        :type project: str</span>
<span class="sd">        :param project: Optional. The project under which the bucket is to</span>
<span class="sd">                        be created. If not passed, uses the project set on</span>
<span class="sd">                        the client.</span>
<span class="sd">        :raises ValueError: if :attr:`user_project` is set.</span>
<span class="sd">        :raises ValueError: if ``project`` is None and client&#39;s</span>
<span class="sd">                            :attr:`project` is also None.</span>

<span class="sd">        :type location: str</span>
<span class="sd">        :param location: Optional. The location of the bucket. If not passed,</span>
<span class="sd">                         the default location, US, will be used. See</span>
<span class="sd">                         https://cloud.google.com/storage/docs/bucket-locations</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot create bucket with &#39;user_project&#39; set.&quot;</span><span class="p">)</span>

        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_require_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">project</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">project</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">project</span>

        <span class="k">if</span> <span class="n">project</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Client project not set:  pass an explicit project.&quot;</span><span class="p">)</span>

        <span class="n">query_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;project&quot;</span><span class="p">:</span> <span class="n">project</span><span class="p">}</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_changes</span><span class="p">}</span>
        <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

        <span class="k">if</span> <span class="n">location</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">location</span>

        <span class="n">api_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">api_request</span><span class="p">(</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/b&quot;</span><span class="p">,</span>
            <span class="n">query_params</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
            <span class="n">_target_object</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_properties</span><span class="p">(</span><span class="n">api_response</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bucket.patch"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.patch">[docs]</a>    <span class="k">def</span> <span class="nf">patch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sends all changed properties in a PATCH request.</span>

<span class="sd">        Updates the ``_properties`` with the response from the backend.</span>

<span class="sd">        If :attr:`user_project` is set, bills the API request to that project.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: the client to use.  If not passed, falls back to the</span>
<span class="sd">                       ``client`` stored on the current object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Special case: For buckets, it is possible that labels are being</span>
        <span class="c1"># removed; this requires special handling.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label_removals</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_changes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;labels&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;labels&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">for</span> <span class="n">removed_label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label_removals</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">][</span><span class="n">removed_label</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Call the superclass method.</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Bucket</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">acl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create our ACL on demand.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acl</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default_object_acl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create our defaultObjectACL on demand.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_object_acl</span>

<div class="viewcode-block" id="Bucket.path_helper"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.path_helper">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">path_helper</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Relative URL path for a bucket.</span>

<span class="sd">        :type bucket_name: str</span>
<span class="sd">        :param bucket_name: The bucket name in the path.</span>

<span class="sd">        :rtype: str</span>
<span class="sd">        :returns: The relative URL path for ``bucket_name``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;/b/&quot;</span> <span class="o">+</span> <span class="n">bucket_name</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The URL path to this bucket.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot determine path without bucket name.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_helper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="Bucket.get_blob"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.get_blob">[docs]</a>    <span class="k">def</span> <span class="nf">get_blob</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">blob_name</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encryption_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">generation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a blob object by name.</span>

<span class="sd">        This will return None if the blob doesn&#39;t exist:</span>

<span class="sd">        .. literalinclude:: snippets.py</span>
<span class="sd">          :start-after: [START get_blob]</span>
<span class="sd">          :end-before: [END get_blob]</span>

<span class="sd">        If :attr:`user_project` is set, bills the API request to that project.</span>

<span class="sd">        :type blob_name: str</span>
<span class="sd">        :param blob_name: The name of the blob to retrieve.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: Optional. The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the current bucket.</span>

<span class="sd">        :type encryption_key: bytes</span>
<span class="sd">        :param encryption_key:</span>
<span class="sd">            Optional 32 byte encryption key for customer-supplied encryption.</span>
<span class="sd">            See</span>
<span class="sd">            https://cloud.google.com/storage/docs/encryption#customer-supplied.</span>

<span class="sd">        :type generation: long</span>
<span class="sd">        :param generation: Optional. If present, selects a specific revision of</span>
<span class="sd">                           this object.</span>

<span class="sd">        :type kwargs: dict</span>
<span class="sd">        :param kwargs: Keyword arguments to pass to the</span>
<span class="sd">                       :class:`~google.cloud.storage.blob.Blob` constructor.</span>

<span class="sd">        :rtype: :class:`google.cloud.storage.blob.Blob` or None</span>
<span class="sd">        :returns: The blob object if it exists, otherwise None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="n">Blob</span><span class="p">(</span>
            <span class="n">bucket</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">blob_name</span><span class="p">,</span>
            <span class="n">encryption_key</span><span class="o">=</span><span class="n">encryption_key</span><span class="p">,</span>
            <span class="n">generation</span><span class="o">=</span><span class="n">generation</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># NOTE: This will not fail immediately in a batch. However, when</span>
            <span class="c1">#       Batch.finish() is called, the resulting `NotFound` will be</span>
            <span class="c1">#       raised.</span>
            <span class="n">blob</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NotFound</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">blob</span></div>

<div class="viewcode-block" id="Bucket.list_blobs"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.list_blobs">[docs]</a>    <span class="k">def</span> <span class="nf">list_blobs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">max_results</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">page_token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">delimiter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">versions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;noAcl&quot;</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an iterator used to find blobs in the bucket.</span>

<span class="sd">        If :attr:`user_project` is set, bills the API request to that project.</span>

<span class="sd">        :type max_results: int</span>
<span class="sd">        :param max_results:</span>
<span class="sd">            (Optional) The maximum number of blobs in each page of results</span>
<span class="sd">            from this request. Non-positive values are ignored. Defaults to</span>
<span class="sd">            a sensible value set by the API.</span>

<span class="sd">        :type page_token: str</span>
<span class="sd">        :param page_token:</span>
<span class="sd">            (Optional) If present, return the next batch of blobs, using the</span>
<span class="sd">            value, which must correspond to the ``nextPageToken`` value</span>
<span class="sd">            returned in the previous response.  Deprecated: use the ``pages``</span>
<span class="sd">            property of the returned iterator instead of manually passing the</span>
<span class="sd">            token.</span>

<span class="sd">        :type prefix: str</span>
<span class="sd">        :param prefix: (Optional) prefix used to filter blobs.</span>

<span class="sd">        :type delimiter: str</span>
<span class="sd">        :param delimiter: (Optional) Delimiter, used with ``prefix`` to</span>
<span class="sd">                          emulate hierarchy.</span>

<span class="sd">        :type versions: bool</span>
<span class="sd">        :param versions: (Optional) Whether object versions should be returned</span>
<span class="sd">                         as separate blobs.</span>

<span class="sd">        :type projection: str</span>
<span class="sd">        :param projection: (Optional) If used, must be &#39;full&#39; or &#39;noAcl&#39;.</span>
<span class="sd">                           Defaults to ``&#39;noAcl&#39;``. Specifies the set of</span>
<span class="sd">                           properties to return.</span>

<span class="sd">        :type fields: str</span>
<span class="sd">        :param fields:</span>
<span class="sd">            (Optional) Selector specifying which fields to include</span>
<span class="sd">            in a partial response. Must be a list of fields. For</span>
<span class="sd">            example to get a partial response with just the next</span>
<span class="sd">            page token and the name and language of each blob returned:</span>
<span class="sd">            ``&#39;items(name,contentLanguage),nextPageToken&#39;``.</span>
<span class="sd">            See: https://cloud.google.com/storage/docs/json_api/v1/parameters#fields</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client`</span>
<span class="sd">        :param client: (Optional) The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the current bucket.</span>

<span class="sd">        :rtype: :class:`~google.api_core.page_iterator.Iterator`</span>
<span class="sd">        :returns: Iterator of all :class:`~google.cloud.storage.blob.Blob`</span>
<span class="sd">                  in this bucket matching the arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">extra_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;projection&quot;</span><span class="p">:</span> <span class="n">projection</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">extra_params</span><span class="p">[</span><span class="s2">&quot;prefix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prefix</span>

        <span class="k">if</span> <span class="n">delimiter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">extra_params</span><span class="p">[</span><span class="s2">&quot;delimiter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">delimiter</span>

        <span class="k">if</span> <span class="n">versions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">extra_params</span><span class="p">[</span><span class="s2">&quot;versions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">versions</span>

        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">extra_params</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">extra_params</span><span class="p">[</span><span class="s2">&quot;userProject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span>

        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_require_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/o&quot;</span>
        <span class="n">iterator</span> <span class="o">=</span> <span class="n">page_iterator</span><span class="o">.</span><span class="n">HTTPIterator</span><span class="p">(</span>
            <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span>
            <span class="n">api_request</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">api_request</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
            <span class="n">item_to_value</span><span class="o">=</span><span class="n">_item_to_blob</span><span class="p">,</span>
            <span class="n">page_token</span><span class="o">=</span><span class="n">page_token</span><span class="p">,</span>
            <span class="n">max_results</span><span class="o">=</span><span class="n">max_results</span><span class="p">,</span>
            <span class="n">extra_params</span><span class="o">=</span><span class="n">extra_params</span><span class="p">,</span>
            <span class="n">page_start</span><span class="o">=</span><span class="n">_blobs_page_start</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">iterator</span><span class="o">.</span><span class="n">bucket</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">iterator</span><span class="o">.</span><span class="n">prefixes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">iterator</span></div>

<div class="viewcode-block" id="Bucket.list_notifications"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.list_notifications">[docs]</a>    <span class="k">def</span> <span class="nf">list_notifications</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;List Pub / Sub notifications for this bucket.</span>

<span class="sd">        See:</span>
<span class="sd">        https://cloud.google.com/storage/docs/json_api/v1/notifications/list</span>

<span class="sd">        If :attr:`user_project` is set, bills the API request to that project.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: Optional. The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the current bucket.</span>

<span class="sd">        :rtype: list of :class:`.BucketNotification`</span>
<span class="sd">        :returns: notification instances</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_require_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/notificationConfigs&quot;</span>
        <span class="n">iterator</span> <span class="o">=</span> <span class="n">page_iterator</span><span class="o">.</span><span class="n">HTTPIterator</span><span class="p">(</span>
            <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span>
            <span class="n">api_request</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">api_request</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
            <span class="n">item_to_value</span><span class="o">=</span><span class="n">_item_to_notification</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">iterator</span><span class="o">.</span><span class="n">bucket</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="n">iterator</span></div>

<div class="viewcode-block" id="Bucket.delete"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete this bucket.</span>

<span class="sd">        The bucket **must** be empty in order to submit a delete request. If</span>
<span class="sd">        ``force=True`` is passed, this will first attempt to delete all the</span>
<span class="sd">        objects / blobs in the bucket (i.e. try to empty the bucket).</span>

<span class="sd">        If the bucket doesn&#39;t exist, this will raise</span>
<span class="sd">        :class:`google.cloud.exceptions.NotFound`.  If the bucket is not empty</span>
<span class="sd">        (and ``force=False``), will raise</span>
<span class="sd">        :class:`google.cloud.exceptions.Conflict`.</span>

<span class="sd">        If ``force=True`` and the bucket contains more than 256 objects / blobs</span>
<span class="sd">        this will cowardly refuse to delete the objects (or the bucket). This</span>
<span class="sd">        is to prevent accidental bucket deletion and to prevent extremely long</span>
<span class="sd">        runtime of this method.</span>

<span class="sd">        If :attr:`user_project` is set, bills the API request to that project.</span>

<span class="sd">        :type force: bool</span>
<span class="sd">        :param force: If True, empties the bucket&#39;s objects then deletes it.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: Optional. The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the current bucket.</span>

<span class="sd">        :raises: :class:`ValueError` if ``force`` is ``True`` and the bucket</span>
<span class="sd">                 contains more than 256 objects / blobs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_require_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
        <span class="n">query_params</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_params</span><span class="p">[</span><span class="s2">&quot;userProject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span>

        <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
            <span class="n">blobs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">list_blobs</span><span class="p">(</span>
                    <span class="n">max_results</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_MAX_OBJECTS_FOR_ITERATION</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">client</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">blobs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAX_OBJECTS_FOR_ITERATION</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;Refusing to delete bucket with more than &quot;</span>
                    <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> objects. If you actually want to delete &quot;</span>
                    <span class="s2">&quot;this bucket, please delete the objects &quot;</span>
                    <span class="s2">&quot;yourself before calling Bucket.delete().&quot;</span>
                <span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_MAX_OBJECTS_FOR_ITERATION</span><span class="p">,)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

            <span class="c1"># Ignore 404 errors on delete.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_blobs</span><span class="p">(</span><span class="n">blobs</span><span class="p">,</span> <span class="n">on_error</span><span class="o">=</span><span class="k">lambda</span> <span class="n">blob</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>

        <span class="c1"># We intentionally pass `_target_object=None` since a DELETE</span>
        <span class="c1"># request has no response value (whether in a standard request or</span>
        <span class="c1"># in a batch request).</span>
        <span class="n">client</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">api_request</span><span class="p">(</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;DELETE&quot;</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
            <span class="n">query_params</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span>
            <span class="n">_target_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Bucket.delete_blob"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.delete_blob">[docs]</a>    <span class="k">def</span> <span class="nf">delete_blob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">blob_name</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">generation</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deletes a blob from the current bucket.</span>

<span class="sd">        If the blob isn&#39;t found (backend 404), raises a</span>
<span class="sd">        :class:`google.cloud.exceptions.NotFound`.</span>

<span class="sd">        For example:</span>

<span class="sd">        .. literalinclude:: snippets.py</span>
<span class="sd">          :start-after: [START delete_blob]</span>
<span class="sd">          :end-before: [END delete_blob]</span>

<span class="sd">        If :attr:`user_project` is set, bills the API request to that project.</span>

<span class="sd">        :type blob_name: str</span>
<span class="sd">        :param blob_name: A blob name to delete.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: Optional. The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the current bucket.</span>

<span class="sd">        :type generation: long</span>
<span class="sd">        :param generation: Optional. If present, permanently deletes a specific</span>
<span class="sd">                           revision of this object.</span>

<span class="sd">        :raises: :class:`google.cloud.exceptions.NotFound` (to suppress</span>
<span class="sd">                 the exception, call ``delete_blobs``, passing a no-op</span>
<span class="sd">                 ``on_error`` callback, e.g.:</span>

<span class="sd">        .. literalinclude:: snippets.py</span>
<span class="sd">            :start-after: [START delete_blobs]</span>
<span class="sd">            :end-before: [END delete_blobs]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_require_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="n">Blob</span><span class="p">(</span><span class="n">blob_name</span><span class="p">,</span> <span class="n">bucket</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation</span><span class="o">=</span><span class="n">generation</span><span class="p">)</span>

        <span class="c1"># We intentionally pass `_target_object=None` since a DELETE</span>
        <span class="c1"># request has no response value (whether in a standard request or</span>
        <span class="c1"># in a batch request).</span>
        <span class="n">client</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">api_request</span><span class="p">(</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;DELETE&quot;</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="n">blob</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
            <span class="n">query_params</span><span class="o">=</span><span class="n">blob</span><span class="o">.</span><span class="n">_query_params</span><span class="p">,</span>
            <span class="n">_target_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Bucket.delete_blobs"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.delete_blobs">[docs]</a>    <span class="k">def</span> <span class="nf">delete_blobs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">blobs</span><span class="p">,</span> <span class="n">on_error</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deletes a list of blobs from the current bucket.</span>

<span class="sd">        Uses :meth:`delete_blob` to delete each individual blob.</span>

<span class="sd">        If :attr:`user_project` is set, bills the API request to that project.</span>

<span class="sd">        :type blobs: list</span>
<span class="sd">        :param blobs: A list of :class:`~google.cloud.storage.blob.Blob`-s or</span>
<span class="sd">                      blob names to delete.</span>

<span class="sd">        :type on_error: callable</span>
<span class="sd">        :param on_error: (Optional) Takes single argument: ``blob``. Called</span>
<span class="sd">                         called once for each blob raising</span>
<span class="sd">                         :class:`~google.cloud.exceptions.NotFound`;</span>
<span class="sd">                         otherwise, the exception is propagated.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client`</span>
<span class="sd">        :param client: (Optional) The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the current bucket.</span>

<span class="sd">        :raises: :class:`~google.cloud.exceptions.NotFound` (if</span>
<span class="sd">                 `on_error` is not passed).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">blob</span> <span class="ow">in</span> <span class="n">blobs</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">blob_name</span> <span class="o">=</span> <span class="n">blob</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">blob_name</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
                    <span class="n">blob_name</span> <span class="o">=</span> <span class="n">blob</span><span class="o">.</span><span class="n">name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_blob</span><span class="p">(</span><span class="n">blob_name</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">NotFound</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">on_error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">on_error</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span></div>

<div class="viewcode-block" id="Bucket.copy_blob"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.copy_blob">[docs]</a>    <span class="k">def</span> <span class="nf">copy_blob</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">blob</span><span class="p">,</span>
        <span class="n">destination_bucket</span><span class="p">,</span>
        <span class="n">new_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">preserve_acl</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">source_generation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copy the given blob to the given bucket, optionally with a new name.</span>

<span class="sd">        If :attr:`user_project` is set, bills the API request to that project.</span>

<span class="sd">        :type blob: :class:`google.cloud.storage.blob.Blob`</span>
<span class="sd">        :param blob: The blob to be copied.</span>

<span class="sd">        :type destination_bucket: :class:`google.cloud.storage.bucket.Bucket`</span>
<span class="sd">        :param destination_bucket: The bucket into which the blob should be</span>
<span class="sd">                                   copied.</span>

<span class="sd">        :type new_name: str</span>
<span class="sd">        :param new_name: (optional) the new name for the copied file.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: Optional. The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the current bucket.</span>

<span class="sd">        :type preserve_acl: bool</span>
<span class="sd">        :param preserve_acl: Optional. Copies ACL from old blob to new blob.</span>
<span class="sd">                             Default: True.</span>

<span class="sd">        :type source_generation: long</span>
<span class="sd">        :param source_generation: Optional. The generation of the blob to be</span>
<span class="sd">                                  copied.</span>

<span class="sd">        :rtype: :class:`google.cloud.storage.blob.Blob`</span>
<span class="sd">        :returns: The new Blob.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_require_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
        <span class="n">query_params</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_params</span><span class="p">[</span><span class="s2">&quot;userProject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span>

        <span class="k">if</span> <span class="n">source_generation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_params</span><span class="p">[</span><span class="s2">&quot;sourceGeneration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">source_generation</span>

        <span class="k">if</span> <span class="n">new_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_name</span> <span class="o">=</span> <span class="n">blob</span><span class="o">.</span><span class="n">name</span>

        <span class="n">new_blob</span> <span class="o">=</span> <span class="n">Blob</span><span class="p">(</span><span class="n">bucket</span><span class="o">=</span><span class="n">destination_bucket</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">new_name</span><span class="p">)</span>
        <span class="n">api_path</span> <span class="o">=</span> <span class="n">blob</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/copyTo&quot;</span> <span class="o">+</span> <span class="n">new_blob</span><span class="o">.</span><span class="n">path</span>
        <span class="n">copy_result</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">api_request</span><span class="p">(</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="n">api_path</span><span class="p">,</span>
            <span class="n">query_params</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span>
            <span class="n">_target_object</span><span class="o">=</span><span class="n">new_blob</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">preserve_acl</span><span class="p">:</span>
            <span class="n">new_blob</span><span class="o">.</span><span class="n">acl</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">acl</span><span class="o">=</span><span class="p">{},</span> <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>

        <span class="n">new_blob</span><span class="o">.</span><span class="n">_set_properties</span><span class="p">(</span><span class="n">copy_result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_blob</span></div>

<div class="viewcode-block" id="Bucket.rename_blob"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.rename_blob">[docs]</a>    <span class="k">def</span> <span class="nf">rename_blob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">blob</span><span class="p">,</span> <span class="n">new_name</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Rename the given blob using copy and delete operations.</span>

<span class="sd">        If :attr:`user_project` is set, bills the API request to that project.</span>

<span class="sd">        Effectively, copies blob to the same bucket with a new name, then</span>
<span class="sd">        deletes the blob.</span>

<span class="sd">        .. warning::</span>

<span class="sd">          This method will first duplicate the data and then delete the</span>
<span class="sd">          old blob.  This means that with very large objects renaming</span>
<span class="sd">          could be a very (temporarily) costly or a very slow operation.</span>

<span class="sd">        :type blob: :class:`google.cloud.storage.blob.Blob`</span>
<span class="sd">        :param blob: The blob to be renamed.</span>

<span class="sd">        :type new_name: str</span>
<span class="sd">        :param new_name: The new name for this blob.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: Optional. The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the current bucket.</span>

<span class="sd">        :rtype: :class:`Blob`</span>
<span class="sd">        :returns: The newly-renamed blob.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">same_name</span> <span class="o">=</span> <span class="n">blob</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">new_name</span>

        <span class="n">new_blob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_blob</span><span class="p">(</span><span class="n">blob</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">new_name</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">same_name</span><span class="p">:</span>
            <span class="n">blob</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_blob</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve or set CORS policies configured for this bucket.</span>

<span class="sd">        See http://www.w3.org/TR/cors/ and</span>
<span class="sd">             https://cloud.google.com/storage/docs/json_api/v1/buckets</span>

<span class="sd">        .. note::</span>

<span class="sd">           The getter for this property returns a list which contains</span>
<span class="sd">           *copies* of the bucket&#39;s CORS policy mappings.  Mutating the list</span>
<span class="sd">           or one of its dicts has no effect unless you then re-assign the</span>
<span class="sd">           dict via the setter.  E.g.:</span>

<span class="sd">           &gt;&gt;&gt; policies = bucket.cors</span>
<span class="sd">           &gt;&gt;&gt; policies.append({&#39;origin&#39;: &#39;/foo&#39;, ...})</span>
<span class="sd">           &gt;&gt;&gt; policies[1][&#39;maxAgeSeconds&#39;] = 3600</span>
<span class="sd">           &gt;&gt;&gt; del policies[0]</span>
<span class="sd">           &gt;&gt;&gt; bucket.cors = policies</span>
<span class="sd">           &gt;&gt;&gt; bucket.update()</span>

<span class="sd">        :setter: Set CORS policies for this bucket.</span>
<span class="sd">        :getter: Gets the CORS policies for this bucket.</span>

<span class="sd">        :rtype: list of dictionaries</span>
<span class="sd">        :returns: A sequence of mappings describing each CORS policy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">policy</span><span class="p">)</span> <span class="k">for</span> <span class="n">policy</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cors&quot;</span><span class="p">,</span> <span class="p">())]</span>

    <span class="nd">@cors</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">cors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entries</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set CORS policies configured for this bucket.</span>

<span class="sd">        See http://www.w3.org/TR/cors/ and</span>
<span class="sd">             https://cloud.google.com/storage/docs/json_api/v1/buckets</span>

<span class="sd">        :type entries: list of dictionaries</span>
<span class="sd">        :param entries: A sequence of mappings describing each CORS policy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_patch_property</span><span class="p">(</span><span class="s2">&quot;cors&quot;</span><span class="p">,</span> <span class="n">entries</span><span class="p">)</span>

    <span class="n">default_event_based_hold</span> <span class="o">=</span> <span class="n">_scalar_property</span><span class="p">(</span><span class="s2">&quot;defaultEventBasedHold&quot;</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;Are uploaded objects automatically placed under an even-based hold?</span>

<span class="sd">    If True, uploaded objects will be placed under an event-based hold to</span>
<span class="sd">    be released at a future time. When released an object will then begin</span>
<span class="sd">    the retention period determined by the policy retention period for the</span>
<span class="sd">    object bucket.</span>

<span class="sd">    See https://cloud.google.com/storage/docs/json_api/v1/buckets</span>

<span class="sd">    If the property is not set locally, returns ``None``.</span>

<span class="sd">    :rtype: bool or ``NoneType``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default_kms_key_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve / set default KMS encryption key for objects in the bucket.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/json_api/v1/buckets</span>

<span class="sd">        :setter: Set default KMS encryption key for items in this bucket.</span>
<span class="sd">        :getter: Get default KMS encryption key for items in this bucket.</span>

<span class="sd">        :rtype: str</span>
<span class="sd">        :returns: Default KMS encryption key, or ``None`` if not set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">encryption_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encryption&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">return</span> <span class="n">encryption_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;defaultKmsKeyName&quot;</span><span class="p">)</span>

    <span class="nd">@default_kms_key_name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">default_kms_key_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set default KMS encryption key for objects in the bucket.</span>

<span class="sd">        :type value: str or None</span>
<span class="sd">        :param value: new KMS key name (None to clear any existing key).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">encryption_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encryption&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">encryption_config</span><span class="p">[</span><span class="s2">&quot;defaultKmsKeyName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_patch_property</span><span class="p">(</span><span class="s2">&quot;encryption&quot;</span><span class="p">,</span> <span class="n">encryption_config</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve or set labels assigned to this bucket.</span>

<span class="sd">        See</span>
<span class="sd">        https://cloud.google.com/storage/docs/json_api/v1/buckets#labels</span>

<span class="sd">        .. note::</span>

<span class="sd">           The getter for this property returns a dict which is a *copy*</span>
<span class="sd">           of the bucket&#39;s labels.  Mutating that dict has no effect unless</span>
<span class="sd">           you then re-assign the dict via the setter.  E.g.:</span>

<span class="sd">           &gt;&gt;&gt; labels = bucket.labels</span>
<span class="sd">           &gt;&gt;&gt; labels[&#39;new_key&#39;] = &#39;some-label&#39;</span>
<span class="sd">           &gt;&gt;&gt; del labels[&#39;old_key&#39;]</span>
<span class="sd">           &gt;&gt;&gt; bucket.labels = labels</span>
<span class="sd">           &gt;&gt;&gt; bucket.update()</span>

<span class="sd">        :setter: Set labels for this bucket.</span>
<span class="sd">        :getter: Gets the labels for this bucket.</span>

<span class="sd">        :rtype: :class:`dict`</span>
<span class="sd">        :returns: Name-value pairs (string-&gt;string) labelling the bucket.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;labels&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

    <span class="nd">@labels</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapping</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set labels assigned to this bucket.</span>

<span class="sd">        See</span>
<span class="sd">        https://cloud.google.com/storage/docs/json_api/v1/buckets#labels</span>

<span class="sd">        :type mapping: :class:`dict`</span>
<span class="sd">        :param mapping: Name-value pairs (string-&gt;string) labelling the bucket.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If any labels have been expressly removed, we need to track this</span>
        <span class="c1"># so that a future .patch() call can do the correct thing.</span>
        <span class="n">existing</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
        <span class="n">incoming</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_label_removals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label_removals</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">existing</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">incoming</span><span class="p">))</span>

        <span class="c1"># Actually update the labels on the object.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_patch_property</span><span class="p">(</span><span class="s2">&quot;labels&quot;</span><span class="p">,</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mapping</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">etag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the ETag for the bucket.</span>

<span class="sd">        See https://tools.ietf.org/html/rfc2616#section-3.11 and</span>
<span class="sd">             https://cloud.google.com/storage/docs/json_api/v1/buckets</span>

<span class="sd">        :rtype: str or ``NoneType``</span>
<span class="sd">        :returns: The bucket etag or ``None`` if the bucket&#39;s</span>
<span class="sd">                  resource has not been loaded from the server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;etag&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the ID for the bucket.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/json_api/v1/buckets</span>

<span class="sd">        :rtype: str or ``NoneType``</span>
<span class="sd">        :returns: The ID of the bucket or ``None`` if the bucket&#39;s</span>
<span class="sd">                  resource has not been loaded from the server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">iam_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve IAM configuration for this bucket.</span>

<span class="sd">        :rtype: :class:`IAMConfiguration`</span>
<span class="sd">        :returns: an instance for managing the bucket&#39;s IAM configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;iamConfiguration&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">return</span> <span class="n">IAMConfiguration</span><span class="o">.</span><span class="n">from_api_repr</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">lifecycle_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve or set lifecycle rules configured for this bucket.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/lifecycle and</span>
<span class="sd">             https://cloud.google.com/storage/docs/json_api/v1/buckets</span>

<span class="sd">        .. note::</span>

<span class="sd">           The getter for this property returns a list which contains</span>
<span class="sd">           *copies* of the bucket&#39;s lifecycle rules mappings.  Mutating the</span>
<span class="sd">           list or one of its dicts has no effect unless you then re-assign</span>
<span class="sd">           the dict via the setter.  E.g.:</span>

<span class="sd">           &gt;&gt;&gt; rules = bucket.lifecycle_rules</span>
<span class="sd">           &gt;&gt;&gt; rules.append({&#39;origin&#39;: &#39;/foo&#39;, ...})</span>
<span class="sd">           &gt;&gt;&gt; rules[1][&#39;rule&#39;][&#39;action&#39;][&#39;type&#39;] = &#39;Delete&#39;</span>
<span class="sd">           &gt;&gt;&gt; del rules[0]</span>
<span class="sd">           &gt;&gt;&gt; bucket.lifecycle_rules = rules</span>
<span class="sd">           &gt;&gt;&gt; bucket.update()</span>

<span class="sd">        :setter: Set lifestyle rules for this bucket.</span>
<span class="sd">        :getter: Gets the lifestyle rules for this bucket.</span>

<span class="sd">        :rtype: generator(dict)</span>
<span class="sd">        :returns: A sequence of mappings describing each lifecycle rule.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lifecycle&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rule&quot;</span><span class="p">,</span> <span class="p">()):</span>
            <span class="n">action_type</span> <span class="o">=</span> <span class="n">rule</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">action_type</span> <span class="o">==</span> <span class="s2">&quot;Delete&quot;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">LifecycleRuleDelete</span><span class="o">.</span><span class="n">from_api_repr</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">action_type</span> <span class="o">==</span> <span class="s2">&quot;SetStorageClass&quot;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">LifecycleRuleSetStorageClass</span><span class="o">.</span><span class="n">from_api_repr</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown lifecycle rule: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rule</span><span class="p">))</span>

    <span class="nd">@lifecycle_rules</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">lifecycle_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set lifestyle rules configured for this bucket.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/lifecycle and</span>
<span class="sd">             https://cloud.google.com/storage/docs/json_api/v1/buckets</span>

<span class="sd">        :type entries: list of dictionaries</span>
<span class="sd">        :param entries: A sequence of mappings describing each lifecycle rule.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span> <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">]</span>  <span class="c1"># Convert helpers if needed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_patch_property</span><span class="p">(</span><span class="s2">&quot;lifecycle&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;rule&quot;</span><span class="p">:</span> <span class="n">rules</span><span class="p">})</span>

<div class="viewcode-block" id="Bucket.clear_lifecyle_rules"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.clear_lifecyle_rules">[docs]</a>    <span class="k">def</span> <span class="nf">clear_lifecyle_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set lifestyle rules configured for this bucket.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/lifecycle and</span>
<span class="sd">             https://cloud.google.com/storage/docs/json_api/v1/buckets</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lifecycle_rules</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="Bucket.add_lifecycle_delete_rule"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.add_lifecycle_delete_rule">[docs]</a>    <span class="k">def</span> <span class="nf">add_lifecycle_delete_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a &quot;delete&quot; rule to lifestyle rules configured for this bucket.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/lifecycle and</span>
<span class="sd">             https://cloud.google.com/storage/docs/json_api/v1/buckets</span>

<span class="sd">        .. literalinclude:: snippets.py</span>
<span class="sd">          :start-after: [START add_lifecycle_delete_rule]</span>
<span class="sd">          :end-before: [END add_lifecycle_delete_rule]</span>

<span class="sd">        :type kw: dict</span>
<span class="sd">        :params kw: arguments passed to :class:`LifecycleRuleConditions`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rules</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lifecycle_rules</span><span class="p">)</span>
        <span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LifecycleRuleDelete</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lifecycle_rules</span> <span class="o">=</span> <span class="n">rules</span></div>

<div class="viewcode-block" id="Bucket.add_lifecycle_set_storage_class_rule"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.add_lifecycle_set_storage_class_rule">[docs]</a>    <span class="k">def</span> <span class="nf">add_lifecycle_set_storage_class_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_class</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a &quot;delete&quot; rule to lifestyle rules configured for this bucket.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/lifecycle and</span>
<span class="sd">             https://cloud.google.com/storage/docs/json_api/v1/buckets</span>

<span class="sd">        .. literalinclude:: snippets.py</span>
<span class="sd">          :start-after: [START add_lifecycle_set_storage_class_rule]</span>
<span class="sd">          :end-before: [END add_lifecycle_set_storage_class_rule]</span>

<span class="sd">        :type storage_class: str, one of :attr:`_STORAGE_CLASSES`.</span>
<span class="sd">        :param storage_class: new storage class to assign to matching items.</span>

<span class="sd">        :type kw: dict</span>
<span class="sd">        :params kw: arguments passed to :class:`LifecycleRuleConditions`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rules</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lifecycle_rules</span><span class="p">)</span>
        <span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LifecycleRuleSetStorageClass</span><span class="p">(</span><span class="n">storage_class</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lifecycle_rules</span> <span class="o">=</span> <span class="n">rules</span></div>

    <span class="n">_location</span> <span class="o">=</span> <span class="n">_scalar_property</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">location</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve location configured for this bucket.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/json_api/v1/buckets and</span>
<span class="sd">        https://cloud.google.com/storage/docs/bucket-locations</span>

<span class="sd">        Returns ``None`` if the property has not been set before creation,</span>
<span class="sd">        or if the bucket&#39;s resource has not been loaded from the server.</span>
<span class="sd">        :rtype: str or ``NoneType``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_location</span>

    <span class="nd">@location</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;(Deprecated) Set `Bucket.location`</span>

<span class="sd">        This can only be set at bucket **creation** time.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/json_api/v1/buckets and</span>
<span class="sd">        https://cloud.google.com/storage/docs/bucket-locations</span>

<span class="sd">        .. warning::</span>

<span class="sd">            Assignment to &#39;Bucket.location&#39; is deprecated, as it is only</span>
<span class="sd">            valid before the bucket is created. Instead, pass the location</span>
<span class="sd">            to `Bucket.create`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">_LOCATION_SETTER_MESSAGE</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_location</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="Bucket.get_logging"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.get_logging">[docs]</a>    <span class="k">def</span> <span class="nf">get_logging</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return info about access logging for this bucket.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/access-logs#status</span>

<span class="sd">        :rtype: dict or None</span>
<span class="sd">        :returns: a dict w/ keys, ``logBucket`` and ``logObjectPrefix``</span>
<span class="sd">                  (if logging is enabled), or None (if not).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;logging&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">info</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bucket.enable_logging"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.enable_logging">[docs]</a>    <span class="k">def</span> <span class="nf">enable_logging</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">,</span> <span class="n">object_prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enable access logging for this bucket.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/access-logs</span>

<span class="sd">        :type bucket_name: str</span>
<span class="sd">        :param bucket_name: name of bucket in which to store access logs</span>

<span class="sd">        :type object_prefix: str</span>
<span class="sd">        :param object_prefix: prefix for access log filenames</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;logBucket&quot;</span><span class="p">:</span> <span class="n">bucket_name</span><span class="p">,</span> <span class="s2">&quot;logObjectPrefix&quot;</span><span class="p">:</span> <span class="n">object_prefix</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_patch_property</span><span class="p">(</span><span class="s2">&quot;logging&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bucket.disable_logging"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.disable_logging">[docs]</a>    <span class="k">def</span> <span class="nf">disable_logging</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Disable access logging for this bucket.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/access-logs#disabling</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_patch_property</span><span class="p">(</span><span class="s2">&quot;logging&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">metageneration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the metageneration for the bucket.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/json_api/v1/buckets</span>

<span class="sd">        :rtype: int or ``NoneType``</span>
<span class="sd">        :returns: The metageneration of the bucket or ``None`` if the bucket&#39;s</span>
<span class="sd">                  resource has not been loaded from the server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metageneration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metageneration&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">metageneration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">metageneration</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">owner</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve info about the owner of the bucket.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/json_api/v1/buckets</span>

<span class="sd">        :rtype: dict or ``NoneType``</span>
<span class="sd">        :returns: Mapping of owner&#39;s role/ID. Returns ``None`` if the bucket&#39;s</span>
<span class="sd">                  resource has not been loaded from the server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">project_number</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the number of the project to which the bucket is assigned.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/json_api/v1/buckets</span>

<span class="sd">        :rtype: int or ``NoneType``</span>
<span class="sd">        :returns: The project number that owns the bucket or ``None`` if</span>
<span class="sd">                  the bucket&#39;s resource has not been loaded from the server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">project_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;projectNumber&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">project_number</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">project_number</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">retention_policy_effective_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the effective time of the bucket&#39;s retention policy.</span>

<span class="sd">        :rtype: datetime.datetime or ``NoneType``</span>
<span class="sd">        :returns: point-in time at which the bucket&#39;s retention policy is</span>
<span class="sd">                  effective, or ``None`` if the property is not</span>
<span class="sd">                  set locally.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">policy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;retentionPolicy&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">policy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;effectiveTime&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_rfc3339_to_datetime</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">retention_policy_locked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve whthere the bucket&#39;s retention policy is locked.</span>

<span class="sd">        :rtype: bool</span>
<span class="sd">        :returns: True if the bucket&#39;s policy is locked, or else False</span>
<span class="sd">                  if the policy is not locked, or the property is not</span>
<span class="sd">                  set locally.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">policy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;retentionPolicy&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">policy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">policy</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;isLocked&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">retention_period</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve or set the retention period for items in the bucket.</span>

<span class="sd">        :rtype: int or ``NoneType``</span>
<span class="sd">        :returns: number of seconds to retain items after upload or release</span>
<span class="sd">                  from event-based lock, or ``None`` if the property is not</span>
<span class="sd">                  set locally.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">policy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;retentionPolicy&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">policy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">period</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;retentionPeriod&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">period</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>

    <span class="nd">@retention_period</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">retention_period</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the retention period for items in the bucket.</span>

<span class="sd">        :type value: int</span>
<span class="sd">        :param value:</span>
<span class="sd">            number of seconds to retain items after upload or release from</span>
<span class="sd">            event-based lock.</span>

<span class="sd">        :raises ValueError: if the bucket&#39;s retention policy is locked.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">policy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;retentionPolicy&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">policy</span><span class="p">[</span><span class="s2">&quot;retentionPeriod&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">policy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_patch_property</span><span class="p">(</span><span class="s2">&quot;retentionPolicy&quot;</span><span class="p">,</span> <span class="n">policy</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">self_link</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the URI for the bucket.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/json_api/v1/buckets</span>

<span class="sd">        :rtype: str or ``NoneType``</span>
<span class="sd">        :returns: The self link for the bucket or ``None`` if</span>
<span class="sd">                  the bucket&#39;s resource has not been loaded from the server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;selfLink&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">storage_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve or set the storage class for the bucket.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/storage-classes</span>

<span class="sd">        :setter: Set the storage class for this bucket.</span>
<span class="sd">        :getter: Gets the the storage class for this bucket.</span>

<span class="sd">        :rtype: str or ``NoneType``</span>
<span class="sd">        :returns: If set, one of &quot;MULTI_REGIONAL&quot;, &quot;REGIONAL&quot;,</span>
<span class="sd">                  &quot;NEARLINE&quot;, &quot;COLDLINE&quot;, &quot;STANDARD&quot;, or</span>
<span class="sd">                  &quot;DURABLE_REDUCED_AVAILABILITY&quot;, else ``None``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;storageClass&quot;</span><span class="p">)</span>

    <span class="nd">@storage_class</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">storage_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the storage class for the bucket.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/storage-classes</span>

<span class="sd">        :type value: str</span>
<span class="sd">        :param value: one of &quot;MULTI_REGIONAL&quot;, &quot;REGIONAL&quot;, &quot;NEARLINE&quot;,</span>
<span class="sd">                      &quot;COLDLINE&quot;, &quot;STANDARD&quot;, or &quot;DURABLE_REDUCED_AVAILABILITY&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_STORAGE_CLASSES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid storage class: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">value</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_patch_property</span><span class="p">(</span><span class="s2">&quot;storageClass&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">time_created</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the timestamp at which the bucket was created.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/json_api/v1/buckets</span>

<span class="sd">        :rtype: :class:`datetime.datetime` or ``NoneType``</span>
<span class="sd">        :returns: Datetime object parsed from RFC3339 valid timestamp, or</span>
<span class="sd">                  ``None`` if the bucket&#39;s resource has not been loaded</span>
<span class="sd">                  from the server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timeCreated&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_rfc3339_to_datetime</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">versioning_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Is versioning enabled for this bucket?</span>

<span class="sd">        See  https://cloud.google.com/storage/docs/object-versioning for</span>
<span class="sd">        details.</span>

<span class="sd">        :setter: Update whether versioning is enabled for this bucket.</span>
<span class="sd">        :getter: Query whether versioning is enabled for this bucket.</span>

<span class="sd">        :rtype: bool</span>
<span class="sd">        :returns: True if enabled, else False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">versioning</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;versioning&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">return</span> <span class="n">versioning</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enabled&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="nd">@versioning_enabled</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">versioning_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enable versioning for this bucket.</span>

<span class="sd">        See  https://cloud.google.com/storage/docs/object-versioning for</span>
<span class="sd">        details.</span>

<span class="sd">        :type value: convertible to boolean</span>
<span class="sd">        :param value: should versioning be enabled for the bucket?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_patch_property</span><span class="p">(</span><span class="s2">&quot;versioning&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">value</span><span class="p">)})</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">requester_pays</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Does the requester pay for API requests for this bucket?</span>

<span class="sd">        See https://cloud.google.com/storage/docs/requester-pays for</span>
<span class="sd">        details.</span>

<span class="sd">        :setter: Update whether requester pays for this bucket.</span>
<span class="sd">        :getter: Query whether requester pays for this bucket.</span>

<span class="sd">        :rtype: bool</span>
<span class="sd">        :returns: True if requester pays for API requests for the bucket,</span>
<span class="sd">                  else False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">versioning</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;billing&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">return</span> <span class="n">versioning</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;requesterPays&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="nd">@requester_pays</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">requester_pays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update whether requester pays for API requests for this bucket.</span>

<span class="sd">        See  https://cloud.google.com/storage/docs/&lt;DOCS-MISSING&gt; for</span>
<span class="sd">        details.</span>

<span class="sd">        :type value: convertible to boolean</span>
<span class="sd">        :param value: should requester pay for API requests for the bucket?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_patch_property</span><span class="p">(</span><span class="s2">&quot;billing&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;requesterPays&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">value</span><span class="p">)})</span>

<div class="viewcode-block" id="Bucket.configure_website"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.configure_website">[docs]</a>    <span class="k">def</span> <span class="nf">configure_website</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">main_page_suffix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">not_found_page</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Configure website-related properties.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/hosting-static-website</span>

<span class="sd">        .. note::</span>
<span class="sd">          This (apparently) only works</span>
<span class="sd">          if your bucket name is a domain name</span>
<span class="sd">          (and to do that, you need to get approved somehow...).</span>

<span class="sd">        If you want this bucket to host a website, just provide the name</span>
<span class="sd">        of an index page and a page to use when a blob isn&#39;t found:</span>

<span class="sd">        .. literalinclude:: snippets.py</span>
<span class="sd">          :start-after: [START configure_website]</span>
<span class="sd">          :end-before: [END configure_website]</span>

<span class="sd">        You probably should also make the whole bucket public:</span>

<span class="sd">        .. literalinclude:: snippets.py</span>
<span class="sd">            :start-after: [START make_public]</span>
<span class="sd">            :end-before: [END make_public]</span>

<span class="sd">        This says: &quot;Make the bucket public, and all the stuff already in</span>
<span class="sd">        the bucket, and anything else I add to the bucket.  Just make it</span>
<span class="sd">        all public.&quot;</span>

<span class="sd">        :type main_page_suffix: str</span>
<span class="sd">        :param main_page_suffix: The page to use as the main page</span>
<span class="sd">                                 of a directory.</span>
<span class="sd">                                 Typically something like index.html.</span>

<span class="sd">        :type not_found_page: str</span>
<span class="sd">        :param not_found_page: The file to use when a page isn&#39;t found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;mainPageSuffix&quot;</span><span class="p">:</span> <span class="n">main_page_suffix</span><span class="p">,</span> <span class="s2">&quot;notFoundPage&quot;</span><span class="p">:</span> <span class="n">not_found_page</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_patch_property</span><span class="p">(</span><span class="s2">&quot;website&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bucket.disable_website"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.disable_website">[docs]</a>    <span class="k">def</span> <span class="nf">disable_website</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Disable the website configuration for this bucket.</span>

<span class="sd">        This is really just a shortcut for setting the website-related</span>
<span class="sd">        attributes to ``None``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">configure_website</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bucket.get_iam_policy"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.get_iam_policy">[docs]</a>    <span class="k">def</span> <span class="nf">get_iam_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the IAM policy for the bucket.</span>

<span class="sd">        See</span>
<span class="sd">        https://cloud.google.com/storage/docs/json_api/v1/buckets/getIamPolicy</span>

<span class="sd">        If :attr:`user_project` is set, bills the API request to that project.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: Optional. The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the current bucket.</span>

<span class="sd">        :rtype: :class:`google.api_core.iam.Policy`</span>
<span class="sd">        :returns: the policy instance, based on the resource returned from</span>
<span class="sd">                  the ``getIamPolicy`` API request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_require_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
        <span class="n">query_params</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_params</span><span class="p">[</span><span class="s2">&quot;userProject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span>

        <span class="n">info</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">api_request</span><span class="p">(</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/iam&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,),</span>
            <span class="n">query_params</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span>
            <span class="n">_target_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">Policy</span><span class="o">.</span><span class="n">from_api_repr</span><span class="p">(</span><span class="n">info</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bucket.set_iam_policy"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.set_iam_policy">[docs]</a>    <span class="k">def</span> <span class="nf">set_iam_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">policy</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the IAM policy for the bucket.</span>

<span class="sd">        See</span>
<span class="sd">        https://cloud.google.com/storage/docs/json_api/v1/buckets/setIamPolicy</span>

<span class="sd">        If :attr:`user_project` is set, bills the API request to that project.</span>

<span class="sd">        :type policy: :class:`google.api_core.iam.Policy`</span>
<span class="sd">        :param policy: policy instance used to update bucket&#39;s IAM policy.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: Optional. The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the current bucket.</span>

<span class="sd">        :rtype: :class:`google.api_core.iam.Policy`</span>
<span class="sd">        :returns: the policy instance, based on the resource returned from</span>
<span class="sd">                  the ``setIamPolicy`` API request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_require_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
        <span class="n">query_params</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_params</span><span class="p">[</span><span class="s2">&quot;userProject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span>

        <span class="n">resource</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="n">to_api_repr</span><span class="p">()</span>
        <span class="n">resource</span><span class="p">[</span><span class="s2">&quot;resourceId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">api_request</span><span class="p">(</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/iam&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,),</span>
            <span class="n">query_params</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">resource</span><span class="p">,</span>
            <span class="n">_target_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">Policy</span><span class="o">.</span><span class="n">from_api_repr</span><span class="p">(</span><span class="n">info</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bucket.test_iam_permissions"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.test_iam_permissions">[docs]</a>    <span class="k">def</span> <span class="nf">test_iam_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">permissions</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;API call:  test permissions</span>

<span class="sd">        See</span>
<span class="sd">        https://cloud.google.com/storage/docs/json_api/v1/buckets/testIamPermissions</span>

<span class="sd">        If :attr:`user_project` is set, bills the API request to that project.</span>

<span class="sd">        :type permissions: list of string</span>
<span class="sd">        :param permissions: the permissions to check</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: Optional. The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the current bucket.</span>

<span class="sd">        :rtype: list of string</span>
<span class="sd">        :returns: the permissions returned by the ``testIamPermissions`` API</span>
<span class="sd">                  request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_require_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
        <span class="n">query_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;permissions&quot;</span><span class="p">:</span> <span class="n">permissions</span><span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_params</span><span class="p">[</span><span class="s2">&quot;userProject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span>

        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/iam/testPermissions&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">api_request</span><span class="p">(</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="n">query_params</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;permissions&quot;</span><span class="p">,</span> <span class="p">[])</span></div>

<div class="viewcode-block" id="Bucket.make_public"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.make_public">[docs]</a>    <span class="k">def</span> <span class="nf">make_public</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">future</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update bucket&#39;s ACL, granting read access to anonymous users.</span>

<span class="sd">        :type recursive: bool</span>
<span class="sd">        :param recursive: If True, this will make all blobs inside the bucket</span>
<span class="sd">                          public as well.</span>

<span class="sd">        :type future: bool</span>
<span class="sd">        :param future: If True, this will make all objects created in the</span>
<span class="sd">                       future public as well.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: Optional. The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the current bucket.</span>

<span class="sd">        :raises ValueError:</span>
<span class="sd">            If ``recursive`` is True, and the bucket contains more than 256</span>
<span class="sd">            blobs.  This is to prevent extremely long runtime of this</span>
<span class="sd">            method.  For such buckets, iterate over the blobs returned by</span>
<span class="sd">            :meth:`list_blobs` and call</span>
<span class="sd">            :meth:`~google.cloud.storage.blob.Blob.make_public`</span>
<span class="sd">            for each blob.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acl</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">grant_read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acl</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">future</span><span class="p">:</span>
            <span class="n">doa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_object_acl</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">doa</span><span class="o">.</span><span class="n">loaded</span><span class="p">:</span>
                <span class="n">doa</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>
            <span class="n">doa</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">grant_read</span><span class="p">()</span>
            <span class="n">doa</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
            <span class="n">blobs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">list_blobs</span><span class="p">(</span>
                    <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">,</span>
                    <span class="n">max_results</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_MAX_OBJECTS_FOR_ITERATION</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">blobs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAX_OBJECTS_FOR_ITERATION</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;Refusing to make public recursively with more than &quot;</span>
                    <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> objects. If you actually want to make every object &quot;</span>
                    <span class="s2">&quot;in this bucket public, iterate through the blobs &quot;</span>
                    <span class="s2">&quot;returned by &#39;Bucket.list_blobs()&#39; and call &quot;</span>
                    <span class="s2">&quot;&#39;make_public&#39; on each one.&quot;</span>
                <span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_MAX_OBJECTS_FOR_ITERATION</span><span class="p">,)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">blob</span> <span class="ow">in</span> <span class="n">blobs</span><span class="p">:</span>
                <span class="n">blob</span><span class="o">.</span><span class="n">acl</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">grant_read</span><span class="p">()</span>
                <span class="n">blob</span><span class="o">.</span><span class="n">acl</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bucket.make_private"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.make_private">[docs]</a>    <span class="k">def</span> <span class="nf">make_private</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">future</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update bucket&#39;s ACL, revoking read access for anonymous users.</span>

<span class="sd">        :type recursive: bool</span>
<span class="sd">        :param recursive: If True, this will make all blobs inside the bucket</span>
<span class="sd">                          private as well.</span>

<span class="sd">        :type future: bool</span>
<span class="sd">        :param future: If True, this will make all objects created in the</span>
<span class="sd">                       future private as well.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: Optional. The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the current bucket.</span>

<span class="sd">        :raises ValueError:</span>
<span class="sd">            If ``recursive`` is True, and the bucket contains more than 256</span>
<span class="sd">            blobs.  This is to prevent extremely long runtime of this</span>
<span class="sd">            method.  For such buckets, iterate over the blobs returned by</span>
<span class="sd">            :meth:`list_blobs` and call</span>
<span class="sd">            :meth:`~google.cloud.storage.blob.Blob.make_private`</span>
<span class="sd">            for each blob.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acl</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">revoke_read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acl</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">future</span><span class="p">:</span>
            <span class="n">doa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_object_acl</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">doa</span><span class="o">.</span><span class="n">loaded</span><span class="p">:</span>
                <span class="n">doa</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>
            <span class="n">doa</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">revoke_read</span><span class="p">()</span>
            <span class="n">doa</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
            <span class="n">blobs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">list_blobs</span><span class="p">(</span>
                    <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">,</span>
                    <span class="n">max_results</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_MAX_OBJECTS_FOR_ITERATION</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">blobs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAX_OBJECTS_FOR_ITERATION</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;Refusing to make private recursively with more than &quot;</span>
                    <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> objects. If you actually want to make every object &quot;</span>
                    <span class="s2">&quot;in this bucket private, iterate through the blobs &quot;</span>
                    <span class="s2">&quot;returned by &#39;Bucket.list_blobs()&#39; and call &quot;</span>
                    <span class="s2">&quot;&#39;make_private&#39; on each one.&quot;</span>
                <span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_MAX_OBJECTS_FOR_ITERATION</span><span class="p">,)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">blob</span> <span class="ow">in</span> <span class="n">blobs</span><span class="p">:</span>
                <span class="n">blob</span><span class="o">.</span><span class="n">acl</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">revoke_read</span><span class="p">()</span>
                <span class="n">blob</span><span class="o">.</span><span class="n">acl</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bucket.generate_upload_policy"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.generate_upload_policy">[docs]</a>    <span class="k">def</span> <span class="nf">generate_upload_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conditions</span><span class="p">,</span> <span class="n">expiration</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a signed upload policy for uploading objects.</span>

<span class="sd">        This method generates and signs a policy document. You can use</span>
<span class="sd">        `policy documents`_ to allow visitors to a website to upload files to</span>
<span class="sd">        Google Cloud Storage without giving them direct write access.</span>

<span class="sd">        For example:</span>

<span class="sd">        .. literalinclude:: snippets.py</span>
<span class="sd">            :start-after: [START policy_document]</span>
<span class="sd">            :end-before: [END policy_document]</span>

<span class="sd">        .. _policy documents:</span>
<span class="sd">            https://cloud.google.com/storage/docs/xml-api\</span>
<span class="sd">            /post-object#policydocument</span>

<span class="sd">        :type expiration: datetime</span>
<span class="sd">        :param expiration: Optional expiration in UTC. If not specified, the</span>
<span class="sd">                           policy will expire in 1 hour.</span>

<span class="sd">        :type conditions: list</span>
<span class="sd">        :param conditions: A list of conditions as described in the</span>
<span class="sd">                          `policy documents`_ documentation.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client`</span>
<span class="sd">        :param client: Optional. The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the current bucket.</span>

<span class="sd">        :rtype: dict</span>
<span class="sd">        :returns: A dictionary of (form field name, form field value) of form</span>
<span class="sd">                  fields that should be added to your HTML upload form in order</span>
<span class="sd">                  to attach the signature.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_require_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
        <span class="n">credentials</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">_base_connection</span><span class="o">.</span><span class="n">credentials</span>
        <span class="n">_signing</span><span class="o">.</span><span class="n">ensure_signed_credentials</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">expiration</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">expiration</span> <span class="o">=</span> <span class="n">_NOW</span><span class="p">()</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">conditions</span> <span class="o">=</span> <span class="n">conditions</span> <span class="o">+</span> <span class="p">[{</span><span class="s2">&quot;bucket&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">}]</span>

        <span class="n">policy_document</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;expiration&quot;</span><span class="p">:</span> <span class="n">_datetime_to_rfc3339</span><span class="p">(</span><span class="n">expiration</span><span class="p">),</span>
            <span class="s2">&quot;conditions&quot;</span><span class="p">:</span> <span class="n">conditions</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">encoded_policy_document</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">policy_document</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">signature</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">credentials</span><span class="o">.</span><span class="n">sign_bytes</span><span class="p">(</span><span class="n">encoded_policy_document</span><span class="p">))</span>

        <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;bucket&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;GoogleAccessId&quot;</span><span class="p">:</span> <span class="n">credentials</span><span class="o">.</span><span class="n">signer_email</span><span class="p">,</span>
            <span class="s2">&quot;policy&quot;</span><span class="p">:</span> <span class="n">encoded_policy_document</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">),</span>
            <span class="s2">&quot;signature&quot;</span><span class="p">:</span> <span class="n">signature</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">fields</span></div>

<div class="viewcode-block" id="Bucket.lock_retention_policy"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.lock_retention_policy">[docs]</a>    <span class="k">def</span> <span class="nf">lock_retention_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Lock the bucket&#39;s retention policy.</span>

<span class="sd">        :raises ValueError:</span>
<span class="sd">            if the bucket has no metageneration (i.e., new or never reloaded);</span>
<span class="sd">            if the bucket has no retention policy assigned;</span>
<span class="sd">            if the bucket&#39;s retention policy is already locked.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;metageneration&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Bucket has no retention policy assigned: try &#39;reload&#39;?&quot;</span><span class="p">)</span>

        <span class="n">policy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;retentionPolicy&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">policy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Bucket has no retention policy assigned: try &#39;reload&#39;?&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">policy</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;isLocked&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Bucket&#39;s retention policy is already locked.&quot;</span><span class="p">)</span>

        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_require_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

        <span class="n">query_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ifMetagenerationMatch&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">metageneration</span><span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_params</span><span class="p">[</span><span class="s2">&quot;userProject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span>

        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/b/</span><span class="si">{}</span><span class="s2">/lockRetentionPolicy&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">api_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">api_request</span><span class="p">(</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">query_params</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span> <span class="n">_target_object</span><span class="o">=</span><span class="bp">self</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_properties</span><span class="p">(</span><span class="n">api_response</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bucket.generate_signed_url"><a class="viewcode-back" href="../../../../storage/buckets.html#google.cloud.storage.bucket.Bucket.generate_signed_url">[docs]</a>    <span class="k">def</span> <span class="nf">generate_signed_url</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">expiration</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">api_access_endpoint</span><span class="o">=</span><span class="n">_API_ACCESS_ENDPOINT</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
        <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">query_parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates a signed URL for this bucket.</span>

<span class="sd">        .. note::</span>

<span class="sd">            If you are on Google Compute Engine, you can&#39;t generate a signed</span>
<span class="sd">            URL using GCE service account. Follow `Issue 50`_ for updates on</span>
<span class="sd">            this. If you&#39;d like to be able to generate a signed URL from GCE,</span>
<span class="sd">            you can use a standard service account from a JSON file rather</span>
<span class="sd">            than a GCE service account.</span>

<span class="sd">        .. _Issue 50: https://github.com/GoogleCloudPlatform/\</span>
<span class="sd">                      google-auth-library-python/issues/50</span>

<span class="sd">        If you have a bucket that you want to allow access to for a set</span>
<span class="sd">        amount of time, you can use this method to generate a URL that</span>
<span class="sd">        is only valid within a certain time period.</span>

<span class="sd">        This is particularly useful if you don&#39;t want publicly</span>
<span class="sd">        accessible buckets, but don&#39;t want to require users to explicitly</span>
<span class="sd">        log in.</span>

<span class="sd">        :type expiration: Union[Integer, datetime.datetime, datetime.timedelta]</span>
<span class="sd">        :param expiration: Point in time when the signed URL should expire.</span>

<span class="sd">        :type api_access_endpoint: str</span>
<span class="sd">        :param api_access_endpoint: Optional URI base.</span>

<span class="sd">        :type method: str</span>
<span class="sd">        :param method: The HTTP verb that will be used when requesting the URL.</span>

<span class="sd">        :type headers: dict</span>
<span class="sd">        :param headers:</span>
<span class="sd">            (Optional) Additional HTTP headers to be included as part of the</span>
<span class="sd">            signed URLs.  See:</span>
<span class="sd">            https://cloud.google.com/storage/docs/xml-api/reference-headers</span>
<span class="sd">            Requests using the signed URL *must* pass the specified header</span>
<span class="sd">            (name and value) with each request for the URL.</span>

<span class="sd">        :type query_parameters: dict</span>
<span class="sd">        :param query_parameters:</span>
<span class="sd">            (Optional) Additional query paramtersto be included as part of the</span>
<span class="sd">            signed URLs.  See:</span>
<span class="sd">            https://cloud.google.com/storage/docs/xml-api/reference-headers#query</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: (Optional) The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the blob&#39;s bucket.</span>


<span class="sd">        :type credentials: :class:`oauth2client.client.OAuth2Credentials` or</span>
<span class="sd">                           :class:`NoneType`</span>
<span class="sd">        :param credentials: (Optional) The OAuth2 credentials to use to sign</span>
<span class="sd">                            the URL. Defaults to the credentials stored on the</span>
<span class="sd">                            client used.</span>

<span class="sd">        :type version: str</span>
<span class="sd">        :param version: (Optional) The version of signed credential to create.</span>
<span class="sd">                        Must be one of &#39;v2&#39; | &#39;v4&#39;.</span>

<span class="sd">        :raises: :exc:`ValueError` when version is invalid.</span>
<span class="sd">        :raises: :exc:`TypeError` when expiration is not a valid type.</span>
<span class="sd">        :raises: :exc:`AttributeError` if credentials is not an instance</span>
<span class="sd">                of :class:`google.auth.credentials.Signing`.</span>

<span class="sd">        :rtype: str</span>
<span class="sd">        :returns: A signed URL you can use to access the resource</span>
<span class="sd">                  until expiration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;v2&quot;</span>
        <span class="k">elif</span> <span class="n">version</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;v2&quot;</span><span class="p">,</span> <span class="s2">&quot;v4&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;version&#39; must be either &#39;v2&#39; or &#39;v4&#39;&quot;</span><span class="p">)</span>

        <span class="n">resource</span> <span class="o">=</span> <span class="s2">&quot;/</span><span class="si">{bucket_name}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucket_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">credentials</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_require_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
            <span class="n">credentials</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">_credentials</span>

        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;v2&quot;</span><span class="p">:</span>
            <span class="n">helper</span> <span class="o">=</span> <span class="n">generate_signed_url_v2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">helper</span> <span class="o">=</span> <span class="n">generate_signed_url_v4</span>

        <span class="k">return</span> <span class="n">helper</span><span class="p">(</span>
            <span class="n">credentials</span><span class="p">,</span>
            <span class="n">resource</span><span class="o">=</span><span class="n">resource</span><span class="p">,</span>
            <span class="n">expiration</span><span class="o">=</span><span class="n">expiration</span><span class="p">,</span>
            <span class="n">api_access_endpoint</span><span class="o">=</span><span class="n">api_access_endpoint</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">query_parameters</span><span class="o">=</span><span class="n">query_parameters</span><span class="p">,</span>
        <span class="p">)</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../index.html">google-cloud</a></h1>



<p class="blurb">Google Cloud Client Libraries for Python</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=GoogleCloudPlatform&repo=google-cloud-python&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../core/index.html">Core Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../asset/index.html">Asset Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../automl/index.html">AutoML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bigquery/index.html">BigQuery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bigquery_datatransfer/index.html">BigQuery Data-Transfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bigquery_storage/index.html">BigQuery Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bigtable/index.html">Bigtable</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../container/index.html">Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../datacatalog/index.html">Data Catalog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../datalabeling/index.html">Data Labeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dlp/index.html">Api Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dlp/index.html#changelog">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dataproc/index.html">Dataproc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../datastore/index.html">Datastore</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dns/index.html">DNS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../firestore/index.html">Firestore</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../iam/index.html">IAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../iot/index.html">IoT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../kms/index.html">Key Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../language/index.html">Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../oslogin/index.html">OSLogin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pubsub/index.html">PubSub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../redis/index.html">Redis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../resource-manager/index.html">Resource Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../runtimeconfig/index.html">Python Client for Google Cloud RuntimeConfig</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../runtimeconfig/index.html#api-reference">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../scheduler/index.html">Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../securitycenter/index.html">Security Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../websecurityscanner/index.html">Security Scanner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../spanner/index.html">Spanner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../speech/index.html">Speech</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../error-reporting/index.html">Usage Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../error-reporting/index.html#api-reference">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../error-reporting/index.html#changelog">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../irm/index.html">Stackdriver Incident Response &amp; Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../logging/index.html">Stackdriver Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../monitoring/index.html">Stackdriver Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../trace/index.html">Stackdriver Trace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../storage/index.html">Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../talent/index.html">Talent</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tasks/index.html">Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../texttospeech/index.html">Text-to-Speech</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../translate/index.html">Translate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../videointelligence/index.html">Video Intelligence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../vision/index.html">Vision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../webrisk/index.html">Web Risk</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../releases.html">Release History</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2014-2017, Google.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    
    <a href="https://github.com/GoogleCloudPlatform/google-cloud-python" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>